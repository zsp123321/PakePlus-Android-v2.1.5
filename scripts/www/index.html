<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è®°è´¦è½¯ä»¶ - ä¸ªäººè´¢åŠ¡ç®¡ç†</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial,sans-serif;line-height:1.6;color:#333;background-color:#f5f5f5}#app{min-height:100vh}.page{display:none}.page.active{display:block}.auth-container{max-width:400px;margin:100px auto;padding:40px;background:white;border-radius:10px;box-shadow:0 5px 15px rgba(0,0,0,.1)}.auth-header{text-align:center;margin-bottom:30px}.auth-header h1{color:#667eea;margin-bottom:10px}.auth-tabs{display:flex;margin-bottom:20px;border-bottom:1px solid #e0e0e0}.tab-button{flex:1;padding:10px;border:none;background:none;cursor:pointer;font-size:16px;color:#666;border-bottom:2px solid transparent}.tab-button.active{color:#667eea;border-bottom-color:#667eea}.form{display:none}.form.active{display:block}.form-group{margin-bottom:20px}.form-group label{display:block;margin-bottom:5px;font-weight:500;color:#555}.form-group input,.form-group select,.form-group textarea{width:100%;padding:10px;border:1px solid #ddd;border-radius:6px;font-size:16px}.form-group input:focus,.form-group select:focus,.form-group textarea:focus{outline:none;border-color:#667eea;box-shadow:0 0 0 2px rgba(102,126,234,.1)}.radio-group{display:flex;gap:20px}.radio-group label{display:flex;align-items:center;gap:5px;cursor:pointer}.primary-button{width:100%;padding:12px;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white;border:none;border-radius:6px;font-size:16px;font-weight:500;cursor:pointer;transition:transform .2s ease}.primary-button:hover{transform:translateY(-2px);box-shadow:0 4px 12px rgba(102,126,234,.3)}.secondary-button{padding:10px 20px;background:#f8f9fa;color:#333;border:1px solid #ddd;border-radius:6px;font-size:14px;cursor:pointer;transition:all .2s ease}.secondary-button:hover{background:#e9ecef}.danger-button{padding:10px 20px;background:#dc3545;color:white;border:none;border-radius:6px;font-size:14px;cursor:pointer}.danger-button:hover{background:#c82333}.navbar{display:flex;justify-content:space-between;align-items:center;padding:20px 40px;background:white;box-shadow:0 2px 4px rgba(0,0,0,.1)}.navbar-brand h2{color:#667eea;margin:0}.navbar-menu{display:flex;gap:20px}.nav-button{padding:8px 16px;border:none;background:none;cursor:pointer;font-size:14px;color:#666;border-radius:4px;transition:all .2s ease}.nav-button:hover,.nav-button.active{color:#667eea;background:rgba(102,126,234,.1)}.content{padding:40px;min-height:calc(100vh - 100px)}.content-page{display:none}.content-page.active{display:block}.page-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:30px}.page-header h3{color:#333;margin:0}.dashboard-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:30px}.date-selector{display:flex;align-items:center;gap:10px}.summary-cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:20px;margin-bottom:30px}.summary-card{background:white;padding:30px;border-radius:10px;box-shadow:0 2px 4px rgba(0,0,0,.08);text-align:center;transition:transform .3s ease}.summary-card:hover{transform:translateY(-5px);box-shadow:0 5px 15px rgba(0,0,0,.1)}.summary-card.income{border-top:4px solid #28a745}.summary-card.expense{border-top:4px solid #dc3545}.summary-card.balance{border-top:4px solid #17a2b8}.summary-card h4{color:#666;margin-bottom:10px}.summary-card .amount{font-size:24px;font-weight:600}.summary-card.income .amount{color:#28a745}.summary-card.expense .amount{color:#dc3545}.summary-card.balance .amount{color:#17a2b8}.chart-container{background:white;padding:30px;border-radius:10px;box-shadow:0 2px 4px rgba(0,0,0,.08);margin-bottom:30px}.chart-container h4{color:#333;margin-bottom:20px}.recent-records{background:white;padding:30px;border-radius:10px;box-shadow:0 2px 4px rgba(0,0,0,.08)}.recent-records h4{color:#333;margin-bottom:20px}.empty-state{text-align:center;padding:40px;color:#666}.empty-state p{margin-bottom:20px}.records-list{background:white;border-radius:10px;box-shadow:0 2px 4px rgba(0,0,0,.08);overflow:hidden}.filter-bar{display:flex;gap:20px;padding:20px;border-bottom:1px solid #f0f0f0;background:#f8f9fa}.filter-bar select,.filter-bar input{padding:8px 12px;border:1px solid #ddd;border-radius:4px}#records-list-content{padding:20px}.categories-tabs{display:flex;margin-bottom:20px;border-bottom:1px solid #e0e0e0}#categories-list{background:white;padding:30px;border-radius:10px;box-shadow:0 2px 4px rgba(0,0,0,.08)}#budgets-list{background:white;padding:30px;border-radius:10px;box-shadow:0 2px 4px rgba(0,0,0,.08)}.date-range-selector{display:flex;align-items:center;gap:10px}.stats-cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px;margin-bottom:30px}.stat-card{background:white;padding:20px;border-radius:10px;box-shadow:0 2px 4px rgba(0,0,0,.08);text-align:center}.stat-card h4{color:#666;margin-bottom:10px;font-size:14px}.stat-value{font-size:20px;font-weight:600;color:#333}.settings-sections{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:30px}.settings-section{background:white;padding:30px;border-radius:10px;box-shadow:0 2px 4px rgba(0,0,0,.08)}.settings-section h4{color:#333;margin-bottom:20px;padding-bottom:10px;border-bottom:1px solid #f0f0f0}.setting-item{margin-bottom:20px}.setting-item label{display:block;margin-bottom:8px;font-weight:500;color:#555}.setting-item input,.setting-item select{width:100%;padding:10px;border:1px solid #ddd;border-radius:6px;font-size:14px}.modal{display:none;position:fixed;z-index:1000;left:0;top:0;width:100%;height:100%;overflow:auto;background-color:rgba(0,0,0,.5)}.modal.active{display:block}.modal-content{background-color:white;margin:15% auto;padding:30px;border-radius:10px;width:90%;max-width:500px;box-shadow:0 5px 20px rgba(0,0,0,.2);animation:slideDown .3s ease}@keyframes slideDown{from{transform:translateY(-50px);opacity:0}to{transform:translateY(0);opacity:1}}.modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;padding-bottom:10px;border-bottom:1px solid #f0f0f0}.modal-header h3{margin:0;color:#333}.close-button{background:none;border:none;font-size:24px;cursor:pointer;color:#666}.close-button:hover{color:#333}.modal-footer{display:flex;justify-content:flex-end;gap:10px;margin-top:30px;padding-top:20px;border-top:1px solid #f0f0f0}.record-item{display:flex;justify-content:space-between;align-items:center;padding:15px;border-bottom:1px solid #f0f0f0}.record-info{flex:1}.record-category{font-weight:500;margin-bottom:5px}.record-date{font-size:12px;color:#666;margin-bottom:5px}.record-description{font-size:12px;color:#999}.record-amount{font-weight:600}.record-amount.income{color:#28a745}.record-amount.expense{color:#dc3545}.record-actions{display:flex;gap:10px;align-items:center}.delete-record-button{padding:5px 10px;font-size:12px;border:1px solid #dc3545;background:#dc3545;color:white;border-radius:4px;cursor:pointer;transition:all .2s ease}.delete-record-button:hover{background:#c82333}.categories-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px}.category-card{background:#f8f9fa;padding:20px;border-radius:8px;text-align:center;border:1px solid #e0e0e0}.category-icon{font-size:24px;margin-bottom:10px}.category-name{font-weight:500;margin-bottom:10px}.category-actions{display:flex;justify-content:center;gap:10px}.category-actions button{padding:5px 10px;font-size:12px;border:1px solid #ddd;background:white;border-radius:4px;cursor:pointer}.budget-item{background:#f8f9fa;padding:20px;border-radius:8px;margin-bottom:20px;border:1px solid #e0e0e0}.budget-info{margin-bottom:15px}.budget-name{font-weight:500;margin-bottom:5px}.budget-period{font-size:12px;color:#666}.budget-amount{font-size:18px;font-weight:600;margin-bottom:10px}.budget-usage{font-size:14px;color:#666}.budget-over{font-size:12px;color:#dc3545;margin-top:5px}@media (max-width:768px){.navbar{flex-direction:column;padding:20px;gap:20px}.navbar-menu{flex-wrap:wrap;justify-content:center}.content{padding:20px}.summary-cards{grid-template-columns:1fr}.stats-cards{grid-template-columns:1fr}.filter-bar{flex-direction:column;align-items:stretch}.date-range-selector{flex-direction:column;align-items:stretch}.modal-content{margin:20% auto;width:95%}}
    </style>
</head>
<body>
    <div id="app">
        <!-- ç™»å½•/æ³¨å†Œé¡µé¢ -->
        <div id="auth-page" class="page active">
            <div class="auth-container">
                <div class="auth-header">
                    <h1>è®°è´¦è½¯ä»¶</h1>
                    <p>è½»æ¾ç®¡ç†æ‚¨çš„è´¢åŠ¡</p>
                </div>
                
                <div class="auth-tabs">
                    <button id="login-tab" class="tab-button active">ç™»å½•</button>
                    <button id="register-tab" class="tab-button">æ³¨å†Œ</button>
                </div>
                
                <!-- ç™»å½•è¡¨å• -->
                <div id="login-form" class="form active">
                    <div class="form-group">
                        <label for="login-email">é‚®ç®±</label>
                        <input type="email" id="login-email" placeholder="è¯·è¾“å…¥é‚®ç®±">
                    </div>
                    <div class="form-group">
                        <label for="login-password">å¯†ç </label>
                        <input type="password" id="login-password" placeholder="è¯·è¾“å…¥å¯†ç ">
                    </div>
                    <button id="login-button" class="primary-button">ç™»å½•</button>
                </div>
                
                <!-- æ³¨å†Œè¡¨å• -->
                <div id="register-form" class="form">
                    <div class="form-group">
                        <label for="register-username">ç”¨æˆ·å</label>
                        <input type="text" id="register-username" placeholder="è¯·è¾“å…¥ç”¨æˆ·å">
                    </div>
                    <div class="form-group">
                        <label for="register-email">é‚®ç®±</label>
                        <input type="email" id="register-email" placeholder="è¯·è¾“å…¥é‚®ç®±">
                    </div>
                    <div class="form-group">
                        <label for="register-password">å¯†ç </label>
                        <input type="password" id="register-password" placeholder="è¯·è¾“å…¥å¯†ç ">
                    </div>
                    <div class="form-group">
                        <label for="register-nickname">æ˜µç§°</label>
                        <input type="text" id="register-nickname" placeholder="è¯·è¾“å…¥æ˜µç§°">
                    </div>
                    <button id="register-button" class="primary-button">æ³¨å†Œ</button>
                </div>
            </div>
        </div>
        
        <!-- ä¸»é¡µé¢ -->
        <div id="main-page" class="page">
            <!-- å¯¼èˆªæ  -->
            <nav class="navbar">
                <div class="navbar-brand">
                    <h2>è®°è´¦è½¯ä»¶</h2>
                </div>
                <div class="navbar-menu">
                    <button class="nav-button active" data-page="dashboard">é¦–é¡µ</button>
                    <button class="nav-button" data-page="records">è®°è´¦</button>
                    <button class="nav-button" data-page="categories">åˆ†ç±»</button>
                    <button class="nav-button" data-page="budgets">é¢„ç®—</button>
                    <button class="nav-button" data-page="statistics">ç»Ÿè®¡</button>
                    <button class="nav-button" data-page="settings">è®¾ç½®</button>
                </div>
                <div class="navbar-user">
                    <button id="logout-button" class="secondary-button">é€€å‡ºç™»å½•</button>
                </div>
            </nav>
            
            <!-- å†…å®¹åŒºåŸŸ -->
            <div class="content">
                <!-- ä»ªè¡¨ç›˜é¡µé¢ -->
                <div id="dashboard" class="content-page active">
                    <div class="dashboard-header">
                        <h3>è´¢åŠ¡æ¦‚è§ˆ</h3>
                        <div class="date-selector">
                            <button id="prev-month">â†</button>
                            <span id="current-month">2026å¹´1æœˆ</span>
                            <button id="next-month">â†’</button>
                        </div>
                    </div>
                    
                    <!-- æ”¶æ”¯æ±‡æ€» -->
                    <div class="summary-cards">
                        <div class="summary-card income">
                            <h4>æœ¬æœˆæ”¶å…¥</h4>
                            <div class="amount" id="monthly-income">Â¥0.00</div>
                        </div>
                        <div class="summary-card expense">
                            <h4>æœ¬æœˆæ”¯å‡º</h4>
                            <div class="amount" id="monthly-expense">Â¥0.00</div>
                        </div>
                        <div class="summary-card balance">
                            <h4>æœ¬æœˆç»“ä½™</h4>
                            <div class="amount" id="monthly-balance">Â¥0.00</div>
                        </div>
                    </div>
                    
                    <!-- æ”¶æ”¯è¶‹åŠ¿ -->
                    <div class="chart-container">
                        <h4>æ”¶æ”¯è¶‹åŠ¿</h4>
                        <canvas id="trend-chart"></canvas>
                    </div>
                    
                    <!-- æœ€è¿‘è®°å½• -->
                    <div class="recent-records">
                        <h4>æœ€è¿‘è®°å½•</h4>
                        <div id="recent-records-list">
                            <div class="empty-state">
                                <p>æš‚æ— è®°è´¦è®°å½•</p>
                                <button id="add-first-record" class="primary-button">æ·»åŠ ç¬¬ä¸€æ¡è®°å½•</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- è®°è´¦é¡µé¢ -->
                <div id="records" class="content-page">
                    <div class="page-header">
                        <h3>è®°è´¦</h3>
                        <button id="add-record-button" class="primary-button">+ æ·»åŠ è®°å½•</button>
                    </div>
                    
                    <!-- è®°å½•åˆ—è¡¨ -->
                    <div class="records-list">
                        <div class="filter-bar">
                            <select id="record-type-filter">
                                <option value="all">å…¨éƒ¨</option>
                                <option value="income">æ”¶å…¥</option>
                                <option value="expense">æ”¯å‡º</option>
                            </select>
                            <input type="date" id="record-date-filter">
                        </div>
                        <div id="records-list-content">
                            <div class="empty-state">
                                <p>æš‚æ— è®°è´¦è®°å½•</p>
                                <button id="add-record-empty" class="primary-button">æ·»åŠ è®°å½•</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- åˆ†ç±»é¡µé¢ -->
                <div id="categories" class="content-page">
                    <div class="page-header">
                        <h3>åˆ†ç±»ç®¡ç†</h3>
                        <button id="add-category-button" class="primary-button">+ æ·»åŠ åˆ†ç±»</button>
                    </div>
                    
                    <div class="categories-tabs">
                        <button id="income-categories-tab" class="tab-button active">æ”¶å…¥åˆ†ç±»</button>
                        <button id="expense-categories-tab" class="tab-button">æ”¯å‡ºåˆ†ç±»</button>
                    </div>
                    
                    <div id="categories-list">
                        <div class="empty-state">
                            <p>æš‚æ— åˆ†ç±»</p>
                        </div>
                    </div>
                </div>
                
                <!-- é¢„ç®—é¡µé¢ -->
                <div id="budgets" class="content-page">
                    <div class="page-header">
                        <h3>é¢„ç®—ç®¡ç†</h3>
                        <button id="add-budget-button" class="primary-button">+ æ·»åŠ é¢„ç®—</button>
                    </div>
                    
                    <div id="budgets-list">
                        <div class="empty-state">
                            <p>æš‚æ— é¢„ç®—</p>
                            <button id="add-budget-empty" class="primary-button">æ·»åŠ é¢„ç®—</button>
                        </div>
                    </div>
                </div>
                
                <!-- ç»Ÿè®¡é¡µé¢ -->
                <div id="statistics" class="content-page">
                    <div class="page-header">
                        <h3>ç»Ÿè®¡åˆ†æ</h3>
                        <div class="date-range-selector">
                            <input type="date" id="stats-start-date">
                            <span>è‡³</span>
                            <input type="date" id="stats-end-date">
                            <button id="apply-date-range" class="primary-button">åº”ç”¨</button>
                        </div>
                    </div>
                    
                    <!-- ç»Ÿè®¡å¡ç‰‡ -->
                    <div class="stats-cards">
                        <div class="stat-card">
                            <h4>æ€»æ”¶å…¥</h4>
                            <div class="stat-value" id="total-income">Â¥0.00</div>
                        </div>
                        <div class="stat-card">
                            <h4>æ€»æ”¯å‡º</h4>
                            <div class="stat-value" id="total-expense">Â¥0.00</div>
                        </div>
                        <div class="stat-card">
                            <h4>ç»“ä½™</h4>
                            <div class="stat-value" id="total-balance">Â¥0.00</div>
                        </div>
                    </div>
                    
                    <!-- åˆ†ç±»é¥¼å›¾ -->
                    <div class="chart-container">
                        <h4>æ”¯å‡ºåˆ†ç±»å æ¯”</h4>
                        <canvas id="category-chart"></canvas>
                    </div>
                    
                    <!-- æ”¶æ”¯è¶‹åŠ¿å›¾ -->
                    <div class="chart-container">
                        <h4>æ”¶æ”¯è¶‹åŠ¿</h4>
                        <canvas id="statistics-trend-chart"></canvas>
                    </div>
                </div>
                
                <!-- è®¾ç½®é¡µé¢ -->
                <div id="settings" class="content-page">
                    <div class="page-header">
                        <h3>è®¾ç½®</h3>
                    </div>
                    
                    <div class="settings-sections">
                        <div class="settings-section">
                            <h4>ä¸ªäººä¿¡æ¯</h4>
                            <div class="setting-item">
                                <label>æ˜µç§°</label>
                                <input type="text" id="setting-nickname">
                            </div>
                            <div class="setting-item">
                                <label>é»˜è®¤å¸ç§</label>
                                <select id="setting-currency">
                                    <option value="CNY">äººæ°‘å¸ (Â¥)</option>
                                    <option value="USD">ç¾å…ƒ ($)</option>
                                    <option value="EUR">æ¬§å…ƒ (â‚¬)</option>
                                </select>
                            </div>
                            <button id="save-profile" class="primary-button">ä¿å­˜</button>
                        </div>
                        
                        <div class="settings-section">
                            <h4>æ•°æ®ç®¡ç†</h4>
                            <button id="backup-data" class="secondary-button">å¤‡ä»½æ•°æ®</button>
                            <button id="export-data" class="secondary-button">å¯¼å‡ºæ•°æ®</button>
                        </div>
                        
                        <div class="settings-section">
                            <h4>è´¦å·å®‰å…¨</h4>
                            <button id="change-password" class="secondary-button">ä¿®æ”¹å¯†ç </button>
                            <button id="logout-settings" class="danger-button">é€€å‡ºç™»å½•</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- æ·»åŠ è®°å½•å¼¹çª— -->
        <div id="add-record-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>æ·»åŠ è®°å½•</h3>
                    <button class="close-button">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label>ç±»å‹</label>
                        <div class="radio-group">
                            <label><input type="radio" name="record-type" value="income" checked> æ”¶å…¥</label>
                            <label><input type="radio" name="record-type" value="expense"> æ”¯å‡º</label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="record-amount">é‡‘é¢</label>
                        <input type="number" id="record-amount" placeholder="è¯·è¾“å…¥é‡‘é¢" step="0.01" min="0">
                    </div>
                    <div class="form-group">
                        <label for="record-category">åˆ†ç±»</label>
                        <select id="record-category"></select>
                    </div>
                    <div class="form-group">
                        <label for="record-date">æ—¥æœŸ</label>
                        <input type="date" id="record-date">
                    </div>
                    <div class="form-group">
                        <label for="record-description">å¤‡æ³¨</label>
                        <textarea id="record-description" placeholder="è¯·è¾“å…¥å¤‡æ³¨"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="secondary-button close-modal">å–æ¶ˆ</button>
                    <button id="save-record-button" class="primary-button">ä¿å­˜</button>
                </div>
            </div>
        </div>
        
        <!-- æ·»åŠ åˆ†ç±»å¼¹çª— -->
        <div id="add-category-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>æ·»åŠ åˆ†ç±»</h3>
                    <button class="close-button">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label>ç±»å‹</label>
                        <div class="radio-group">
                            <label><input type="radio" name="category-type" value="income"> æ”¶å…¥</label>
                            <label><input type="radio" name="category-type" value="expense" checked> æ”¯å‡º</label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="category-name">åˆ†ç±»åç§°</label>
                        <input type="text" id="category-name" placeholder="è¯·è¾“å…¥åˆ†ç±»åç§°">
                    </div>
                    <div class="form-group">
                        <label for="category-icon">å›¾æ ‡</label>
                        <input type="text" id="category-icon" placeholder="è¯·è¾“å…¥å›¾æ ‡åç§°">
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="secondary-button close-modal">å–æ¶ˆ</button>
                    <button id="save-category-button" class="primary-button">ä¿å­˜</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const AppState={user:null,token:null,currentPage:'dashboard',currentMonth:new Date(),records:[],categories:[{id:1,name:'å·¥èµ„',type:'income',icon:'wallet'},{id:2,name:'å…¼èŒ',type:'income',icon:'briefcase'},{id:3,name:'ç†è´¢æ”¶ç›Š',type:'income',icon:'trending-up'},{id:4,name:'å…¶ä»–æ”¶å…¥',type:'income',icon:'plus-circle'},{id:5,name:'é¤é¥®',type:'expense',icon:'utensils'},{id:6,name:'äº¤é€š',type:'expense',icon:'car'},{id:7,name:'ä½æˆ¿',type:'expense',icon:'home'},{id:8,name:'è´­ç‰©',type:'expense',icon:'shopping-cart'},{id:9,name:'å¨±ä¹',type:'expense',icon:'film'},{id:10,name:'åŒ»ç–—',type:'expense',icon:'heartbeat'},{id:11,name:'æ•™è‚²',type:'expense',icon:'book'},{id:12,name:'å…¶ä»–æ”¯å‡º',type:'expense',icon:'ellipsis-h'}],budgets:[]};document.addEventListener('DOMContentLoaded',function(){initializeApp();setupEventListeners();loadMockData()});function initializeApp(){const savedUser=localStorage.getItem('finance-user');const savedRecords=localStorage.getItem('finance-records');const savedCategories=localStorage.getItem('finance-categories');if(savedUser){AppState.user=JSON.parse(savedUser);showMainPage();loadDashboardData()}else{showAuthPage()}if(savedRecords){AppState.records=JSON.parse(savedRecords)}if(savedCategories){AppState.categories=JSON.parse(savedCategories)}}function loadMockData(){const mockRecords=[{id:1,user_id:1,amount:5000,type:'income',category_id:1,category_name:'å·¥èµ„',date:'2026-01-01',description:'æœˆè–ª'},{id:2,user_id:1,amount:128,type:'expense',category_id:5,category_name:'é¤é¥®',date:'2026-01-02',description:'åˆé¤'},{id:3,user_id:1,amount:35,type:'expense',category_id:6,category_name:'äº¤é€š',date:'2026-01-03',description:'æ‰“è½¦'},{id:4,user_id:1,amount:899,type:'expense',category_id:8,category_name:'è´­ç‰©',date:'2026-01-04',description:'è´­ç‰©'},{id:5,user_id:1,amount:200,type:'expense',category_id:9,category_name:'å¨±ä¹',date:'2026-01-05',description:'ç”µå½±ç¥¨'}];AppState.records=mockRecords;localStorage.setItem('finance-records',JSON.stringify(mockRecords))}function setupEventListeners(){document.getElementById('login-tab').addEventListener('click',()=>switchAuthTab('login'));document.getElementById('register-tab').addEventListener('click',()=>switchAuthTab('register'));document.getElementById('login-button').addEventListener('click',handleLogin);document.getElementById('register-button').addEventListener('click',handleRegister);document.querySelectorAll('.nav-button').forEach(button=>{button.addEventListener('click',(e)=>{const page=e.target.dataset.page;switchPage(page)})});document.getElementById('logout-button').addEventListener('click',handleLogout);document.getElementById('logout-settings').addEventListener('click',handleLogout);document.getElementById('add-record-button').addEventListener('click',showAddRecordModal);document.getElementById('add-first-record').addEventListener('click',showAddRecordModal);document.getElementById('add-record-empty').addEventListener('click',showAddRecordModal);document.getElementById('save-record-button').addEventListener('click',saveRecord);document.querySelectorAll('.close-button, .close-modal').forEach(button=>{button.addEventListener('click',closeModal)});document.getElementById('income-categories-tab').addEventListener('click',()=>switchCategoryTab('income'));document.getElementById('expense-categories-tab').addEventListener('click',()=>switchCategoryTab('expense'));document.getElementById('prev-month').addEventListener('click',()=>changeMonth(-1));document.getElementById('next-month').addEventListener('click',()=>changeMonth(1));document.getElementById('apply-date-range').addEventListener('click',applyDateRange);document.getElementById('save-profile').addEventListener('click',saveProfile);document.getElementById('backup-data').addEventListener('click',backupData);document.getElementById('export-data').addEventListener('click',exportData);document.getElementById('add-category-button').addEventListener('click',showAddCategoryModal);document.getElementById('save-category-button').addEventListener('click',saveCategory)}function switchAuthTab(tab){if(tab==='login'){document.getElementById('login-tab').classList.add('active');document.getElementById('register-tab').classList.remove('active');document.getElementById('login-form').classList.add('active');document.getElementById('register-form').classList.remove('active')}else{document.getElementById('register-tab').classList.add('active');document.getElementById('login-tab').classList.remove('active');document.getElementById('register-form').classList.add('active');document.getElementById('login-form').classList.remove('active')}}function handleLogin(){const email=document.getElementById('login-email').value;const password=document.getElementById('login-password').value;if(!email||!password){alert('è¯·å¡«å†™æ‰€æœ‰å¿…å¡«å­—æ®µ');return}const mockUser={id:1,username:'testuser',email:email,nickname:'æµ‹è¯•ç”¨æˆ·',default_currency:'CNY'};AppState.user=mockUser;localStorage.setItem('finance-user',JSON.stringify(mockUser));showMainPage();loadDashboardData()}function handleRegister(){const username=document.getElementById('register-username').value;const email=document.getElementById('register-email').value;const password=document.getElementById('register-password').value;const nickname=document.getElementById('register-nickname').value;if(!username||!email||!password||!nickname){alert('è¯·å¡«å†™æ‰€æœ‰å¿…å¡«å­—æ®µ');return}const mockUser={id:1,username:username,email:email,nickname:nickname,default_currency:'CNY'};AppState.user=mockUser;localStorage.setItem('finance-user',JSON.stringify(mockUser));showMainPage();loadDashboardData()}function showAuthPage(){document.getElementById('auth-page').classList.add('active');document.getElementById('main-page').classList.remove('active')}function showMainPage(){document.getElementById('main-page').classList.add('active');document.getElementById('auth-page').classList.remove('active')}function switchPage(page){document.querySelectorAll('.nav-button').forEach(button=>{button.classList.remove('active');if(button.dataset.page===page){button.classList.add('active')}});document.querySelectorAll('.content-page').forEach(contentPage=>{contentPage.classList.remove('active');if(contentPage.id===page){contentPage.classList.add('active')}});AppState.currentPage=page;if(page==='dashboard'){loadDashboardData()}else if(page==='records'){loadRecordsData()}else if(page==='categories'){loadCategoriesData()}else if(page==='budgets'){loadBudgetsData()}else if(page==='statistics'){loadStatisticsData()}else if(page==='settings'){loadSettingsData()}}function handleLogout(){localStorage.removeItem('finance-user');localStorage.removeItem('finance-records');AppState.user=null;AppState.records=[];showAuthPage()}function showAddRecordModal(){const modal=document.getElementById('add-record-modal');modal.classList.add('active');const today=new Date().toISOString().split('T')[0];document.getElementById('record-date').value=today;loadCategoryOptions()}function closeModal(){document.getElementById('add-record-modal').classList.remove('active');document.getElementById('add-category-modal').classList.remove('active')}function loadCategoryOptions(){const categorySelect=document.getElementById('record-category');const recordType=document.querySelector('input[name="record-type"]:checked').value;categorySelect.innerHTML='';AppState.categories.filter(cat=>cat.type===recordType).forEach(category=>{const option=document.createElement('option');option.value=category.id;option.textContent=category.name;categorySelect.appendChild(option)})}function showAddCategoryModal(){const modal=document.getElementById('add-category-modal');modal.classList.add('active');const activeTab=document.querySelector('.categories-tabs .tab-button.active');const type=activeTab.textContent.includes('æ”¶å…¥')?'income':'expense';const radioButtons=document.querySelectorAll('input[name="category-type"]');radioButtons.forEach(radio=>{radio.checked=radio.value===type})}function saveCategory(){const categoryType=document.querySelector('input[name="category-type"]:checked').value;const categoryName=document.getElementById('category-name').value;const categoryIcon=document.getElementById('category-icon').value;if(!categoryName){alert('è¯·å¡«å†™åˆ†ç±»åç§°');return}const newCategory={id:AppState.categories.length+1,name:categoryName,type:categoryType,icon:categoryIcon||'ğŸ“'};AppState.categories.push(newCategory);localStorage.setItem('finance-categories',JSON.stringify(AppState.categories));document.getElementById('add-category-modal').classList.remove('active');alert('åˆ†ç±»æ·»åŠ æˆåŠŸ');loadCategoriesData()}function saveRecord(){const recordType=document.querySelector('input[name="record-type"]:checked').value;const amount=document.getElementById('record-amount').value;const categoryId=document.getElementById('record-category').value;const date=document.getElementById('record-date').value;const description=document.getElementById('record-description').value;if(!amount||!categoryId||!date){alert('è¯·å¡«å†™é‡‘é¢ã€åˆ†ç±»å’Œæ—¥æœŸ');return}const newRecord={id:AppState.records.length+1,user_id:AppState.user.id,amount:parseFloat(amount),type:recordType,category_id:parseInt(categoryId),category_name:AppState.categories.find(cat=>cat.id===parseInt(categoryId)).name,date:date,description:description,created_at:new Date().toISOString()};AppState.records.push(newRecord);localStorage.setItem('finance-records',JSON.stringify(AppState.records));closeModal();alert('è®°å½•ä¿å­˜æˆåŠŸ');loadDashboardData();loadRecordsData()}function loadDashboardData(){if(!AppState.user)return;const monthElement=document.getElementById('current-month');const incomeElement=document.getElementById('monthly-income');const expenseElement=document.getElementById('monthly-expense');const balanceElement=document.getElementById('monthly-balance');const year=AppState.currentMonth.getFullYear();const month=AppState.currentMonth.getMonth()+1;monthElement.textContent=`${year}å¹´${month}æœˆ`;const startDate=`${year}-${String(month).padStart(2,'0')}-01`;const endDate=`${year}-${String(month).padStart(2,'0')}-${new Date(year,month,0).getDate()}`;const monthlyRecords=AppState.records.filter(record=>{return record.date>=startDate&&record.date<=endDate});const income=monthlyRecords.filter(r=>r.type==='income').reduce((sum,r)=>sum+r.amount,0);const expense=monthlyRecords.filter(r=>r.type==='expense').reduce((sum,r)=>sum+r.amount,0);const balance=income-expense;incomeElement.textContent=`Â¥${income.toFixed(2)}`;expenseElement.textContent=`Â¥${expense.toFixed(2)}`;balanceElement.textContent=`Â¥${balance.toFixed(2)}`;loadTrendChart(monthlyRecords);loadRecentRecords()}function loadTrendChart(records){const ctx=document.getElementById('trend-chart').getContext('2d');if(window.trendChart){window.trendChart.destroy()}const dateMap={};records.forEach(record=>{if(!dateMap[record.date]){dateMap[record.date]={date:record.date,income:0,expense:0}}if(record.type==='income'){dateMap[record.date].income+=record.amount}else{dateMap[record.date].expense+=record.amount}});const trends=Object.values(dateMap).sort((a,b)=>a.date.localeCompare(b.date));const labels=trends.map(item=>item.date);const incomeData=trends.map(item=>item.income);const expenseData=trends.map(item=>item.expense);window.trendChart=new Chart(ctx,{type:'line',data:{labels:labels,datasets:[{label:'æ”¶å…¥',data:incomeData,borderColor:'#28a745',backgroundColor:'rgba(40, 167, 69, 0.1)',fill:true,tension:0.4},{label:'æ”¯å‡º',data:expenseData,borderColor:'#dc3545',backgroundColor:'rgba(220, 53, 69, 0.1)',fill:true,tension:0.4}]},options:{responsive:true,plugins:{legend:{position:'top'},tooltip:{mode:'index',intersect:false}},scales:{y:{beginAtZero:true,ticks:{callback:function(value){return'Â¥'+value}}}}}})}function loadRecentRecords(){const recordsList=document.getElementById('recent-records-list');const recentRecords=AppState.records.slice(-5).reverse();if(recentRecords.length===0){recordsList.innerHTML=`
                    <div class="empty-state">
                        <p>æš‚æ— è®°è´¦è®°å½•</p>
                        <button id="add-first-record" class="primary-button">æ·»åŠ ç¬¬ä¸€æ¡è®°å½•</button>
                    </div>
                `;document.getElementById('add-first-record').addEventListener('click',showAddRecordModal)}else{recordsList.innerHTML=recentRecords.map(record=>`
                    <div class="record-item">
                        <div class="record-info">
                            <div class="record-category">${record.category_name}</div>
                            <div class="record-date">${record.date}</div>
                            <div class="record-description">${record.description||''}</div>
                        </div>
                        <div class="record-amount ${record.type==='income'?'income':'expense'}">
                            ${record.type==='income'?'+':'-'}Â¥${record.amount.toFixed(2)}
                        </div>
                    </div>
                `).join('')}}function loadRecordsData(){if(!AppState.user)return;const recordsListContent=document.getElementById('records-list-content');if(AppState.records.length===0){recordsListContent.innerHTML=`
                    <div class="empty-state">
                        <p>æš‚æ— è®°è´¦è®°å½•</p>
                        <button id="add-record-empty" class="primary-button">æ·»åŠ è®°å½•</button>
                    </div>
                `;document.getElementById('add-record-empty').addEventListener('click',showAddRecordModal)}else{recordsListContent.innerHTML=AppState.records.map(record=>`
                    <div class="record-item">
                        <div class="record-info">
                            <div class="record-category">${record.category_name}</div>
                            <div class="record-date">${record.date}</div>
                            <div class="record-description">${record.description||''}</div>
                        </div>
                        <div class="record-amount ${record.type==='income'?'income':'expense'}">
                            ${record.type==='income'?'+':'-'}Â¥${record.amount.toFixed(2)}
                        </div>
                        <div class="record-actions">
                            <button class="delete-record-button" data-id="${record.id}">åˆ é™¤</button>
                        </div>
                    </div>
                `).join('');AppState.records.forEach(record=>{const deleteButton=document.querySelector(`.delete-record-button[data-id="${record.id}"]`);if(deleteButton){deleteButton.addEventListener('click',()=>deleteRecord(record.id))}})}}function deleteRecord(recordId){if(!AppState.user){alert('è¯·å…ˆç™»å½•');return}const record=AppState.records.find(r=>r.id===recordId);if(!record){alert('è®°å½•ä¸å­˜åœ¨');return}if(record.user_id!==AppState.user.id){alert('æ— æƒé™åˆ é™¤æ­¤è®°å½•');return}if(confirm(`ç¡®å®šè¦åˆ é™¤è®°å½•å—ï¼Ÿ\nåˆ†ç±»ï¼š${record.category_name}\né‡‘é¢ï¼š${record.type==='income'?'+':'-'}Â¥${record.amount.toFixed(2)}\næ—¥æœŸï¼š${record.date}`)){AppState.records=AppState.records.filter(r=>r.id!==recordId);localStorage.setItem('finance-records',JSON.stringify(AppState.records));saveDeleteLog(record);alert('è®°å½•åˆ é™¤æˆåŠŸ');loadDashboardData();loadRecordsData()}}function saveDeleteLog(record){const logs=JSON.parse(localStorage.getItem('finance-delete-logs')||'[]');logs.push({id:Date.now(),user_id:AppState.user.id,user_email:AppState.user.email,record_id:record.id,record_type:record.type,record_category:record.category_name,record_amount:record.amount,record_date:record.date,delete_time:new Date().toISOString()});localStorage.setItem('finance-delete-logs',JSON.stringify(logs))}function loadCategoriesData(){if(!AppState.user)return;const categoriesList=document.getElementById('categories-list');const activeTab=document.querySelector('.categories-tabs .tab-button.active');const type=activeTab.textContent.includes('æ”¶å…¥')?'income':'expense';const filteredCategories=AppState.categories.filter(cat=>cat.type===type);categoriesList.innerHTML=`
                <div class="categories-grid">
                    ${filteredCategories.map(category=>`
                        <div class="category-card">
                            <div class="category-icon">${category.icon||'ğŸ“'}</div>
                            <div class="category-name">${category.name}</div>
                            <div class="category-actions">
                                <button class="edit-category">ç¼–è¾‘</button>
                                <button class="delete-category">åˆ é™¤</button>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `}function loadBudgetsData(){if(!AppState.user)return;const budgetsList=document.getElementById('budgets-list');if(AppState.budgets.length===0){budgetsList.innerHTML=`
                    <div class="empty-state">
                        <p>æš‚æ— é¢„ç®—</p>
                        <button id="add-budget-empty" class="primary-button">æ·»åŠ é¢„ç®—</button>
                    </div>
                `}else{budgetsList.innerHTML=AppState.budgets.map(budget=>`
                    <div class="budget-item">
                        <div class="budget-info">
                            <div class="budget-name">${budget.type==='overall'?'æ€»é¢„ç®—':'åˆ†ç±»é¢„ç®—'}</div>
                            <div class="budget-period">${budget.start_date} è‡³ ${budget.end_date}</div>
                        </div>
                        <div class="budget-details">
                            <div class="budget-amount">Â¥${budget.amount.toFixed(2)}</div>
                            <div class="budget-usage">
                                ä½¿ç”¨: Â¥${(budget.usage?.used||0).toFixed(2)} (${(budget.usage?.percentage||0).toFixed(1)}%)
                            </div>
                            ${budget.usage?.is_over?'<div class="budget-over">å·²è¶…æ”¯</div>':''}
                        </div>
                    </div>
                `).join('')}}function loadStatisticsData(){if(!AppState.user)return;const today=new Date();const startOfMonth=new Date(today.getFullYear(),today.getMonth(),1).toISOString().split('T')[0];const endOfMonth=new Date(today.getFullYear(),today.getMonth()+1,0).toISOString().split('T')[0];document.getElementById('stats-start-date').value=startOfMonth;document.getElementById('stats-end-date').value=endOfMonth;fetchStatisticsData(startOfMonth,endOfMonth)}function applyDateRange(){const startDate=document.getElementById('stats-start-date').value;const endDate=document.getElementById('stats-end-date').value;if(startDate&&endDate){fetchStatisticsData(startDate,endDate)}}function fetchStatisticsData(startDate,endDate){if(!AppState.user)return;const filteredRecords=AppState.records.filter(record=>{return record.date>=startDate&&record.date<=endDate});const income=filteredRecords.filter(r=>r.type==='income').reduce((sum,r)=>sum+r.amount,0);const expense=filteredRecords.filter(r=>r.type==='expense').reduce((sum,r)=>sum+r.amount,0);const balance=income-expense;document.getElementById('total-income').textContent=`Â¥${income.toFixed(2)}`;document.getElementById('total-expense').textContent=`Â¥${expense.toFixed(2)}`;document.getElementById('total-balance').textContent=`Â¥${balance.toFixed(2)}`;loadCategoryChart(filteredRecords.filter(r=>r.type==='expense'));loadStatisticsTrendChart(filteredRecords)}function loadCategoryChart(expenseRecords){const ctx=document.getElementById('category-chart').getContext('2d');if(window.categoryChart){window.categoryChart.destroy()}const categoryMap={};expenseRecords.forEach(record=>{if(!categoryMap[record.category_id]){categoryMap[record.category_id]={id:record.category_id,name:record.category_name,total:0}}categoryMap[record.category_id].total+=record.amount});const categories=Object.values(categoryMap);const labels=categories.map(cat=>cat.name);const data=categories.map(cat=>cat.total);const backgroundColors=['#FF6384','#36A2EB','#FFCE56','#4BC0C0','#9966FF','#FF9F40','#C9CBCF','#FF6384','#36A2EB','#FFCE56'];window.categoryChart=new Chart(ctx,{type:'pie',data:{labels:labels,datasets:[{data:data,backgroundColor:backgroundColors.slice(0,categories.length),borderWidth:1}]},options:{responsive:true,plugins:{legend:{position:'right'}}}})}function loadStatisticsTrendChart(records){const ctx=document.getElementById('statistics-trend-chart').getContext('2d');if(window.statisticsTrendChart){window.statisticsTrendChart.destroy()}const dateMap={};records.forEach(record=>{if(!dateMap[record.date]){dateMap[record.date]={date:record.date,income:0,expense:0}}if(record.type==='income'){dateMap[record.date].income+=record.amount}else{dateMap[record.date].expense+=record.amount}});const trends=Object.values(dateMap).sort((a,b)=>a.date.localeCompare(b.date));const labels=trends.map(item=>item.date);const incomeData=trends.map(item=>item.income);const expenseData=trends.map(item=>item.expense);window.statisticsTrendChart=new Chart(ctx,{type:'bar',data:{labels:labels,datasets:[{label:'æ”¶å…¥',data:incomeData,backgroundColor:'#28a745'},{label:'æ”¯å‡º',data:expenseData,backgroundColor:'#dc3545'}]},options:{responsive:true,plugins:{legend:{position:'top'}},scales:{y:{beginAtZero:true,ticks:{callback:function(value){return'Â¥'+value}}}}}})}function loadSettingsData(){if(!AppState.user)return;document.getElementById('setting-nickname').value=AppState.user.nickname;document.getElementById('setting-currency').value=AppState.user.default_currency||'CNY'}function saveProfile(){if(!AppState.user)return;const nickname=document.getElementById('setting-nickname').value;const defaultCurrency=document.getElementById('setting-currency').value;AppState.user.nickname=nickname;AppState.user.default_currency=defaultCurrency;localStorage.setItem('finance-user',JSON.stringify(AppState.user));alert('ä¸ªäººèµ„æ–™ä¿å­˜æˆåŠŸ')}function backupData(){if(!AppState.user)return;const backupData={user:AppState.user,records:AppState.records,categories:AppState.categories,budgets:AppState.budgets,timestamp:new Date().toISOString()};const dataStr=JSON.stringify(backupData,null,2);const dataBlob=new Blob([dataStr],{type:'application/json'});const url=URL.createObjectURL(dataBlob);const link=document.createElement('a');link.href=url;link.download=`finance-backup-${new Date().toISOString().split('T')[0]}.json`;link.click();URL.revokeObjectURL(url);alert('æ•°æ®å¤‡ä»½æˆåŠŸ')}function exportData(){if(!AppState.user)return;const csvHeader='ID,Date,Type,Category,Amount,Description\n';const csvContent=AppState.records.map(record=>{return`${record.id},${record.date},${record.type},${record.category_name},${record.amount},${record.description||''}`}).join('\n');const csv=csvHeader+csvContent;const dataBlob=new Blob([csv],{type:'text/csv'});const url=URL.createObjectURL(dataBlob);const link=document.createElement('a');link.href=url;link.download=`finance-export-${new Date().toISOString().split('T')[0]}.csv`;link.click();URL.revokeObjectURL(url)}function changeMonth(direction){const newDate=new Date(AppState.currentMonth);newDate.setMonth(newDate.getMonth()+direction);AppState.currentMonth=newDate;loadDashboardData()}function switchCategoryTab(type){const incomeTab=document.getElementById('income-categories-tab');const expenseTab=document.getElementById('expense-categories-tab');if(type==='income'){incomeTab.classList.add('active');expenseTab.classList.remove('active')}else{expenseTab.classList.add('active');incomeTab.classList.remove('active')}loadCategoriesData()}
    </script>
</body>
</html>